---
import { useStoryblokApi } from '@storyblok/astro'
// @ts-ignore
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'
import EntryLayout from '../layouts/EntryLayout.astro'
import parseUrl from '@/storyblok/utils/parseUrl'
import isPreview from '@/storyblok/utils/isPreview'
import generateStaticPaths from '@/storyblok/utils/generateStaticPaths'
export async function getStaticPaths() {
  const paths = await generateStaticPaths()
  // console.log('paths', paths)
  return paths
}
const params = Astro.params
let props = isPreview() ? parseUrl(params?.slug) : Astro.props
const { slug, language, langSwitch } = props
const storyblokApi = useStoryblokApi()
const { data } = await storyblokApi.get(
  `cdn/stories/${slug === undefined ? 'home' : slug}`,
  {
    version: isPreview() ? 'draft' : 'published',
    resolve_relations: ['popular-articles.articles'],
    language,
  },
)
const story = data.story
// console.log('[...slug] story', story)
---

{story?.content && <StoryblokComponent story={story} blok={story?.content} />}
